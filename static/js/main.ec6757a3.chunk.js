(this.webpackJsonpprolog_js=this.webpackJsonpprolog_js||[]).push([[0],{168:function(e,t,n){e.exports=n(315)},173:function(e,t,n){},174:function(e,t,n){},315:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),i=n.n(o),s=(n(173),n(174),n(41)),u=n.n(s),c=n(62),l=n(65),h=n(66),p=n(96),d=n(93),f=n(317),g=n(63),m=n(137),v=n.n(m),b="http://hk-d.npls.io:5000";console.log("baseURL",b);var k=new(function(){function e(){Object(l.a)(this,e),this.http=v.a.create({baseURL:b}),this.http.interceptors.response.use((function(e){return e}),(function(e){var t=e;t.response&&(t=t.response),t.data&&(t=t.data),t.message&&(t=t.message),console.log("[Error]",t);var n="string"===typeof t?t:JSON.stringify(t);return f.b.error(n),Promise.reject(e)}))}return Object(h.a)(e,[{key:"setJwt",value:function(e){console.log("setJwt",e),this.jwt=e,this.http.defaults.headers.Authorization="Bearer ".concat(e)}},{key:"getAuthUrl",value:function(e){return this.http.get("/login",{params:{callbackUrl:e}})}},{key:"login",value:function(e){return this.http.post("/login",e)}},{key:"getRepo",value:function(){return this.http.get("/repos/OpenWrtBuild")}},{key:"getRuns",value:function(){return this.http.get("/repos/OpenWrtBuild/runs")}},{key:"addRun",value:function(){return this.http.post("/repos/OpenWrtBuild/runs")}},{key:"rmRun",value:function(e){return this.http.delete("/repos/OpenWrtBuild/runs/".concat(e))}}]),e}()),w=n(141),y=n.n(w),j=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={authUrl:null,jwt:null},e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.login()}},{key:"login",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r,a,o,i,s,c,l,h,p,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=sessionStorage.getItem("jwt"))){e.next=5;break}this.onJwt(t),e.next=25;break;case 5:if(n=window,r=n.location,a=n.history,o=r.search,i=r.href,!("code"in(s=y.a.parse(o.substr(1))))){e.next=19;break}return c=f.b.loading("Loading...",0),e.next=12,k.login(s);case 12:l=e.sent,h=l.data,this.onJwt(h),c(),a.pushState({},null,r.origin),e.next=25;break;case 19:return e.next=21,k.getAuthUrl(i);case 21:p=e.sent,d=p.data,console.log("getAuthUrl",d),this.setState({authUrl:d});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onJwt",value:function(e){sessionStorage.setItem("jwt",e),k.setJwt(e),this.setState({jwt:e})}},{key:"render",value:function(){var e=this.state,t=e.authUrl;return e.jwt?this.props.children:a.a.createElement("div",null,a.a.createElement(g.a,{type:"primary",onClick:function(){window.location.href=t}},"\u767b\u5f55"))}}]),n}(r.Component),O=n(318),R=n(316),x=n(142),E=n.n(x),S=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={repo:null,runs:[]},e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.getRepo()}},{key:"getRepo",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.b.loading("getRepo",0),e.next=3,k.getRepo();case 3:n=e.sent,r=n.data,console.log("getRepo",r),this.setState({repo:r}),t(),this.getRuns();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRuns",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.b.loading("getRuns",0),e.next=3,k.getRuns();case 3:n=e.sent,r=n.data,console.log("getRuns",r),this.setState({runs:r}),t();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"build",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.b.loading("build",0),e.next=3,k.addRun();case 3:t(),this.getRuns();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.b.loading("cancel",0),e.next=3,k.rmRun(t);case 3:n(),this.getRuns();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.repo,r=t.runs;return n?a.a.createElement("div",null,a.a.createElement(O.b,{direction:"vertical"},a.a.createElement("div",null,a.a.createElement("a",{href:n.html_url,target:"_blank",rel:"noopener noreferrer"},n.name," [",n.id,"]")),a.a.createElement(O.b,null,a.a.createElement(g.a,{type:"primary",onClick:this.build.bind(this)},"\u7f16\u8bd1"),a.a.createElement(g.a,{onClick:this.getRuns.bind(this)},"\u5237\u65b0")),!E.a.isEmpty(r)&&a.a.createElement(R.a,{columns:[{title:"ID",dataIndex:"id",render:function(e,t){return a.a.createElement("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer"},e)}},{title:"STATUS",dataIndex:"status"},{title:"CONCLUSION",dataIndex:"conclusion"},{title:"MSG",dataIndex:["head_commit","message"]},{title:"OP",render:function(t){return a.a.createElement("div",null,!t.conclusion&&a.a.createElement(g.a,{size:"small",danger:!0,onClick:e.cancel.bind(e,t.id)},"\u53d6\u6d88"))}}],dataSource:r,rowKey:"id",size:"small",bordered:!0,pagination:!1}))):"Loading..."}}]),n}(r.Component);var U=function(){return a.a.createElement("div",{className:"m-3"},a.a.createElement(j,null,a.a.createElement(S,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[168,1,2]]]);