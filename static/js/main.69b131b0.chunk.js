(this.webpackJsonpprolog_js=this.webpackJsonpprolog_js||[]).push([[0],{194:function(e,t,n){e.exports=n(347)},199:function(e,t,n){},200:function(e,t,n){},347:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(17),o=n.n(i),s=(n(199),n(22)),c=(n(200),n(50)),l=n.n(c),u=n(76),p=n(61),m=n(62),h=n(89),d=n(87),f=n(353),v=n(192),g=n(49),b=n(165),E=n.n(b),_=n(166),y=n.n(_),k="https://api.openwrt-build.cf";console.log("baseURL",k);var w=new(function(){function e(){Object(p.a)(this,e),this.http=null,this.http=y.a.create({baseURL:k}),this.http.interceptors.response.use((function(e){return e}),(function(e){var t=e;if(t.response&&401===(t=t.response).status)return v.b.warn("\u4f1a\u8bdd\u8fc7\u671f\u91cd\u65b0\u767b\u5f55",1,(function(){window.location.reload()})),sessionStorage.clear(),Promise.reject(e);t.data&&(t=t.data),t.message&&(t=t.message),console.log("[Error]",t);var n="string"===typeof t?t:JSON.stringify(t);return v.b.error(n),Promise.reject(e)}))}return Object(m.a)(e,[{key:"setJwt",value:function(e){console.log("setJwt",e),this.jwt=e,this.http.defaults.headers.Authorization="Bearer ".concat(e)}},{key:"getAuthUrl",value:function(e){return this.http.get("/login",{params:{callbackUrl:e}})}},{key:"login",value:function(e){return this.http.post("/login",e)}},{key:"getRepo",value:function(){return this.http.get("/repos/OpenWrtBuild")}},{key:"getRuns",value:function(){return this.http.get("/repos/OpenWrtBuild/runs")}},{key:"addRun",value:function(e){return this.http.post("/repos/OpenWrtBuild/runs",e)}},{key:"rmRun",value:function(e){return this.http.delete("/repos/OpenWrtBuild/runs/".concat(e))}}]),e}()),x=n(352),j=n(168),O=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){return a.a.createElement(j.a,{indicator:a.a.createElement(x.a,null)})}}]),n}(r.Component),I=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={authUrl:null,jwt:null},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.login()}},{key:"login",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,i,o,s,c,u,p,m,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=sessionStorage.getItem("jwt"))){e.next=5;break}this.onJwt(t),e.next=25;break;case 5:if(n=window,r=n.location,a=n.history,i=r.search,o=r.href,!("code"in(s=E.a.parse(i.substr(1))))){e.next=19;break}return c=v.b.loading("Loading...",0),e.next=12,w.login(s);case 12:u=e.sent,p=u.data,this.onJwt(p),c(),a.pushState({},null,r.origin),e.next=25;break;case 19:return e.next=21,w.getAuthUrl(o);case 21:m=e.sent,h=m.data,console.log("getAuthUrl",h),this.setState({authUrl:h});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onJwt",value:function(e){sessionStorage.setItem("jwt",e),w.setJwt(e),this.setState({jwt:e})}},{key:"render",value:function(){var e=this.state,t=e.authUrl;return e.jwt?this.props.children:a.a.createElement("div",null,t?a.a.createElement(g.a,{type:"primary",size:"large",icon:a.a.createElement(f.a,null),onClick:function(){window.location.href=t}},"\u767b\u5f55"):a.a.createElement(O,null))}}]),n}(r.Component),C=n(351),R=n(348),D=n(350),S=n(349),V=n(97),B=n(170),J=n.n(B),U=n(354),A=n(355),W=n(356),z={x86_64_DEVICE_generic:"x86_64",x86_generic_DEVICE_generic:"x86","bcm27xx_bcm2711_DEVICE_rpi-4":"Raspberry Pi 4 Model B",ramips_mt7620_DEVICE_hiwifi_hc5661:null,ramips_mt7620_DEVICE_hiwifi_hc5761:null,ramips_mt7621_DEVICE_phicomm_k2p:null,"ramips_mt7621_DEVICE_xiaomi_mi-router-ac2100":null,ramips_mt7621_DEVICE_xiaomi_mir3g:null,"ramips_mt7621_DEVICE_xiaomi_mir3g-v2":null,ramips_mt7621_DEVICE_xiaomi_mir3p:null,ramips_mt7621_DEVICE_xiaomi_mir4:null,"ramips_mt7621_DEVICE_xiaomi_redmi-router-ac2100":"Redmi AC2100"},P=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={repo:null,runs:[],v:!1},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.getRepo()}},{key:"getRepo",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.b.loading("\u83b7\u53d6\u4ed3\u5e93\u4fe1\u606f",0),e.prev=1,e.next=4,w.getRepo();case 4:n=e.sent,r=n.data,console.log("getRepo",r),this.setState({repo:r});case 8:return e.prev=8,t(),e.finish(8);case 11:this.getRuns();case 12:case"end":return e.stop()}}),e,this,[[1,,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getRuns",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.b.loading("\u83b7\u53d6\u4efb\u52a1\u5217\u8868",0),e.prev=1,e.next=4,w.getRuns();case 4:n=e.sent,r=n.data,console.log("getRuns",r),this.setState({runs:r});case 8:return e.prev=8,t(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[1,,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"build",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.b.loading("\u63d0\u4ea4\u7f16\u8bd1\u8bf7\u6c42",0),e.prev=1,e.next=4,w.addRun(t);case 4:return e.prev=4,n(),e.finish(4);case 7:setTimeout(this.getRuns.bind(this),1500);case 8:case"end":return e.stop()}}),e,this,[[1,,4,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.b.loading("\u53d6\u6d88\u4efb\u52a1 [".concat(t,"]"),0),e.prev=1,e.next=4,w.rmRun(t);case 4:return e.prev=4,n(),v.b.success("\u53d6\u6d88\u7533\u8bf7\u8bf7\u6c42\u5df2\u63d0\u4ea4"),e.finish(4);case 8:setTimeout(this.getRuns.bind(this),3e3);case 9:case"end":return e.stop()}}),e,this,[[1,,4,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onFinish",value:function(e){this.build(e),this.setState({v:!1})}},{key:"render",value:function(){var e=this,t=this.state,n=t.repo,r=t.runs,i=t.v;return n?a.a.createElement("div",null,a.a.createElement(C.b,{direction:"vertical"},a.a.createElement("div",null,a.a.createElement("a",{href:n.html_url,target:"_blank",rel:"noopener noreferrer"},n.name," [",n.id,"]")),a.a.createElement(C.b,null,a.a.createElement(g.a,{type:"primary",icon:a.a.createElement(U.a,null),onClick:function(){return e.setState({v:!0})}},"\u7f16\u8bd1"),a.a.createElement(g.a,{icon:a.a.createElement(A.a,null),onClick:this.getRuns.bind(this)},"\u5237\u65b0")),!J.a.isEmpty(r)&&a.a.createElement(R.a,{columns:[{title:"ID",dataIndex:"id",render:function(e,t){return a.a.createElement("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer"},e)}},{title:"\u72b6\u6001",dataIndex:"status"},{title:"\u7ed3\u679c",dataIndex:"conclusion"},{title:"\u5907\u6ce8",dataIndex:["head_commit","message"]},{title:"\u56fa\u4ef6",dataIndex:["artifacts_url"],render:function(e,t){return"success"===t.conclusion&&a.a.createElement("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer"},"\u4e0b\u8f7d")}},{title:"\u64cd\u4f5c",render:function(t){return a.a.createElement("div",null,!t.conclusion&&a.a.createElement(g.a,{size:"small",danger:!0,icon:a.a.createElement(W.a,null),onClick:e.cancel.bind(e,t.id)},"\u53d6\u6d88"))}}],dataSource:r,rowKey:"id",size:"small",bordered:!0,pagination:!1})),a.a.createElement(D.a,{title:"\u7f16\u8bd1\u53c2\u6570",visible:i,onCancel:function(){e.setState({v:!1})},okButtonProps:{form:"build",htmlType:"submit"}},a.a.createElement(S.a,{id:"build",layout:"vertical",onFinish:this.onFinish.bind(this)},a.a.createElement(S.a.Item,{label:"\u76ee\u6807\u8bbe\u5907",name:"name",rules:[{required:!0}]},a.a.createElement(V.a,{placeholder:"--- \u8bf7\u9009\u62e9 ---"},Object.keys(z).map((function(e){return a.a.createElement(V.a.Option,{key:e,value:e},z[e]?z[e]:e)}))))))):a.a.createElement(O,null)}}]),n}(r.Component),F=n(187);var L=function(){return a.a.createElement(s.a,{locale:F.a},a.a.createElement("div",{className:"m-3"},a.a.createElement(I,null,a.a.createElement(P,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[194,1,2]]]);