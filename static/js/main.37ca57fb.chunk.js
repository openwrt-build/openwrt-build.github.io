(this.webpackJsonpprolog_js=this.webpackJsonpprolog_js||[]).push([[0],{207:function(e,t,n){e.exports=n(369)},212:function(e,t,n){},213:function(e,t,n){},369:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(23),l=n.n(i),o=(n(212),n(22)),c=(n(213),n(52)),s=n.n(c),u=n(80),m=n(66),p=n(67),h=n(91),d=n(89),f=n(377),v=n(204),E=n(375),g=n(51),b=n(371),_=n(372),y=n(173),k=n.n(y),w=n(174),x=n.n(w),j="https://api.openwrt-build.cf";console.log("baseURL",j);var O=new(function(){function e(){Object(m.a)(this,e),this.http=null,this.http=x.a.create({baseURL:j}),this.http.interceptors.response.use((function(e){return e}),(function(e){var t=e;if(t.response&&401===(t=t.response).status)return v.b.warn("\u4f1a\u8bdd\u8fc7\u671f\u91cd\u65b0\u767b\u5f55",1,(function(){window.location.reload()})),sessionStorage.clear(),Promise.reject(e);t.data&&(t=t.data),t.message&&(t=t.message),console.log("[Error]",t);var n="string"===typeof t?t:JSON.stringify(t);return v.b.error(n),Promise.reject(e)}))}return Object(p.a)(e,[{key:"setJwt",value:function(e){console.log("setJwt",e),this.jwt=e,this.http.defaults.headers.Authorization="Bearer ".concat(e)}},{key:"getAuthUrl",value:function(e){return this.http.get("/login",{params:{callbackUrl:e}})}},{key:"login",value:function(e){return this.http.post("/login",e)}},{key:"getRepo",value:function(){return this.http.get("/repos/OpenWrtBuild")}},{key:"getRuns",value:function(){return this.http.get("/repos/OpenWrtBuild/runs")}},{key:"addRun",value:function(e){return this.http.post("/repos/OpenWrtBuild/runs",e)}},{key:"rmRun",value:function(e){return this.http.delete("/repos/OpenWrtBuild/runs/".concat(e))}}]),e}()),I=n(376),C=n(176),R=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return r.a.createElement(C.a,{indicator:r.a.createElement(I.a,null)})}}]),n}(a.Component),D=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={authUrl:null,jwt:null},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.login()}},{key:"login",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a,r,i,l,o,c,u,m,p,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=sessionStorage.getItem("jwt"))){e.next=5;break}this.onJwt(t),e.next=25;break;case 5:if(n=window,a=n.location,r=n.history,i=a.search,l=a.href,!("code"in(o=k.a.parse(i.substr(1))))){e.next=19;break}return c=v.b.loading("Loading...",0),e.next=12,O.login(o);case 12:u=e.sent,m=u.data,this.onJwt(m),c(),r.pushState({},null,a.origin),e.next=25;break;case 19:return e.next=21,O.getAuthUrl(l);case 21:p=e.sent,h=p.data,console.log("getAuthUrl",h),this.setState({authUrl:h});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onJwt",value:function(e){sessionStorage.setItem("jwt",e),O.setJwt(e),this.setState({jwt:e})}},{key:"render",value:function(){var e=this.state,t=e.authUrl;return e.jwt?this.props.children:r.a.createElement("div",null,t?r.a.createElement(E.b,{direction:"vertical"},r.a.createElement(g.a,{type:"primary",size:"large",icon:r.a.createElement(f.a,null),onClick:function(){window.location.href=t}},"\u767b\u5f55"),r.a.createElement(b.a,{title:"\u5de5\u4f5c\u539f\u7406"},r.a.createElement("ol",null,r.a.createElement("li",null,"\u6388\u6743Github\u767b\u5f55"),r.a.createElement("li",null,"\u521b\u5efa\u7f16\u8bd1\u4ed3\u5e93\uff08\u5728\u60a8\u4e2a\u4eba\u7684\u8d26\u53f7\u4e0b\uff09"),r.a.createElement("li",null,"\u6839\u636e\u60a8\u9009\u62e9\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u89e6\u53d1Actions\u8fdb\u884c\u7f16\u8bd1"),r.a.createElement("li",null,"\u4e0b\u8f7d\u56fa\u4ef6"))),r.a.createElement(b.a,{title:"\u9690\u79c1\u58f0\u660e"},r.a.createElement("ol",{style:{color:"#ff4d4f"}},r.a.createElement("li",null,"\u672c\u5de5\u5177\u65e8\u5728\u7b80\u5316\u60a8\u7684\u56fa\u4ef6\u7f16\u8bd1\u6d41\u7a0b\uff0c"),r.a.createElement("li",null,"\u6240\u6709\u6570\u636e\u5747\u5b58\u50a8\u4e8e\u60a8\u7684\u4e2a\u4eba\u4ee3\u7801\u4ed3\u5e93"),r.a.createElement("li",null,"\u672c\u7ad9\u4e0d\u4f1a\u5b58\u50a8\u60a8\u7684\u4efb\u4f55\u4eba\u4e2a\u4fe1\u606f"),r.a.createElement("li",null,"\u8bf7\u653e\u5fc3\u4f7f\u7528")),r.a.createElement(_.a.Text,{type:"danger"}))):r.a.createElement(R,null))}}]),n}(a.Component),S=n(370),V=n(374),B=n(373),J=n(99),U=n(185),A=n.n(U),W=n(378),T=n(379),z=n(380),P={x86_64_DEVICE_generic:"x86_64",x86_generic_DEVICE_generic:"x86","bcm27xx_bcm2711_DEVICE_rpi-4":"Raspberry Pi 4 Model B",ramips_mt7620_DEVICE_hiwifi_hc5661:null,ramips_mt7620_DEVICE_hiwifi_hc5761:null,ramips_mt7621_DEVICE_phicomm_k2p:null,"ramips_mt7621_DEVICE_xiaomi_mi-router-ac2100":null,ramips_mt7621_DEVICE_xiaomi_mir3g:null,"ramips_mt7621_DEVICE_xiaomi_mir3g-v2":null,ramips_mt7621_DEVICE_xiaomi_mir3p:null,ramips_mt7621_DEVICE_xiaomi_mir4:null,"ramips_mt7621_DEVICE_xiaomi_redmi-router-ac2100":"Redmi AC2100"},F=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={repo:null,runs:[],v:!1},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getRepo()}},{key:"getRepo",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.b.loading("\u83b7\u53d6\u4ed3\u5e93\u4fe1\u606f",0),e.prev=1,e.next=4,O.getRepo();case 4:n=e.sent,a=n.data,console.log("getRepo",a),this.setState({repo:a});case 8:return e.prev=8,t(),e.finish(8);case 11:this.getRuns();case 12:case"end":return e.stop()}}),e,this,[[1,,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getRuns",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.b.loading("\u83b7\u53d6\u4efb\u52a1\u5217\u8868",0),e.prev=1,e.next=4,O.getRuns();case 4:n=e.sent,a=n.data,console.log("getRuns",a),this.setState({runs:a});case 8:return e.prev=8,t(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[1,,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"build",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.b.loading("\u63d0\u4ea4\u7f16\u8bd1\u8bf7\u6c42",0),e.prev=1,e.next=4,O.addRun(t);case 4:return e.prev=4,n(),e.finish(4);case 7:setTimeout(this.getRuns.bind(this),1500);case 8:case"end":return e.stop()}}),e,this,[[1,,4,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.b.loading("\u53d6\u6d88\u4efb\u52a1 [".concat(t,"]"),0),e.prev=1,e.next=4,O.rmRun(t);case 4:return e.prev=4,n(),v.b.success("\u53d6\u6d88\u7533\u8bf7\u8bf7\u6c42\u5df2\u63d0\u4ea4"),e.finish(4);case 8:setTimeout(this.getRuns.bind(this),3e3);case 9:case"end":return e.stop()}}),e,this,[[1,,4,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onFinish",value:function(e){this.build(e),this.setState({v:!1})}},{key:"render",value:function(){var e=this,t=this.state,n=t.repo,a=t.runs,i=t.v;return n?r.a.createElement("div",null,r.a.createElement(E.b,{direction:"vertical"},r.a.createElement("div",null,r.a.createElement("a",{href:n.html_url,target:"_blank",rel:"noopener noreferrer"},n.name," [",n.id,"]")),r.a.createElement(E.b,null,r.a.createElement(g.a,{type:"primary",icon:r.a.createElement(W.a,null),onClick:function(){return e.setState({v:!0})}},"\u7f16\u8bd1"),r.a.createElement(g.a,{icon:r.a.createElement(T.a,null),onClick:this.getRuns.bind(this)},"\u5237\u65b0")),!A.a.isEmpty(a)&&r.a.createElement(S.a,{columns:[{title:"ID",dataIndex:"id",render:function(e,t){return r.a.createElement("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer"},e)}},{title:"\u72b6\u6001",dataIndex:"status"},{title:"\u7ed3\u679c",dataIndex:"conclusion"},{title:"\u5907\u6ce8",dataIndex:["head_commit","message"]},{title:"\u56fa\u4ef6",dataIndex:["artifacts_url"],render:function(e,t){return"success"===t.conclusion&&r.a.createElement("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer"},"\u4e0b\u8f7d")}},{title:"\u64cd\u4f5c",render:function(t){return r.a.createElement("div",null,!t.conclusion&&r.a.createElement(g.a,{size:"small",danger:!0,icon:r.a.createElement(z.a,null),onClick:e.cancel.bind(e,t.id)},"\u53d6\u6d88"))}}],dataSource:a,rowKey:"id",size:"small",bordered:!0,pagination:!1})),r.a.createElement(V.a,{title:"\u7f16\u8bd1\u53c2\u6570",visible:i,onCancel:function(){e.setState({v:!1})},okButtonProps:{form:"build",htmlType:"submit"}},r.a.createElement(B.a,{id:"build",layout:"vertical",onFinish:this.onFinish.bind(this)},r.a.createElement(B.a.Item,{label:"\u76ee\u6807\u8bbe\u5907",name:"name",rules:[{required:!0}]},r.a.createElement(J.a,{placeholder:"--- \u8bf7\u9009\u62e9 ---"},Object.keys(P).map((function(e){return r.a.createElement(J.a.Option,{key:e,value:e},P[e]?P[e]:e)})))),r.a.createElement(_.a.Text,{type:"danger"},"\u5373\u5c06\u5f00\u653e\u4e0a\u4f20\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7f16\u8bd1\u529f\u80fd\uff0c\u656c\u8bf7\u671f\u5f85\uff0c\u8c22\u8c22\uff01")))):r.a.createElement(R,null)}}]),n}(a.Component),L=n(199);var M=function(){return r.a.createElement(o.b,{locale:L.a},r.a.createElement("div",{className:"m-3"},r.a.createElement(D,null,r.a.createElement(F,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[207,1,2]]]);